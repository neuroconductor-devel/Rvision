<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>4 - In-place, copy, and target operations • Rvision</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="4 - In-place, copy, and target operations">
<meta property="og:description" content="Rvision">
<meta property="og:image" content="https://swarm-lab.github.io/ROpenCVLite/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Rvision</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/z1_install.html">1 - Installing Rvision</a>
    </li>
    <li>
      <a href="../articles/z2_io.html">2 - Input/output operations</a>
    </li>
    <li>
      <a href="../articles/z3_basic.html">3 - Basic operations</a>
    </li>
    <li>
      <a href="../articles/z4_inplace.html">4 - In-place, copy, and target operations</a>
    </li>
    <li>
      <a href="../articles/z5_gpu.html">5 - GPU operations</a>
    </li>
    <li>
      <a href="../articles/z6_queue.html">6 - Capture queues</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/swarm-lab/Rvision/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="z4_inplace_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>4 - In-place, copy, and target operations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/swarm-lab/Rvision/blob/master/vignettes/z4_inplace.Rmd"><code>vignettes/z4_inplace.Rmd</code></a></small>
      <div class="hidden name"><code>z4_inplace.Rmd</code></div>

    </div>

    
    
<div id="better-performances-with-in-place-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#better-performances-with-in-place-operations" class="anchor"></a>4.1 - Better performances with in-place operations</h2>
<p>While other image processing libraries for <code>R</code> are fast enough for most operations on single images and often offer more options than <code>Rvision</code> (but we are working on closing the gap on that front), <code>Rvision</code> really shines in the high-speed processing of large volumes of images (e.g. video and camera streams).</p>
<p>Part of the reason is that <a href="https://opencv.org/"><code>OpenCV</code></a> - the computer vision library on top of which <code>Rvision</code> is built - is designed and optimized for in-place operations, that is operations that change directly the content of an object in memory without making a copy of it. Indeed, making copies of objects in memory - especially of large ones like images - can add a significant amount of time to an operation. For that reason, most of <code>Rvision</code>’s functions offer the option to perform their operations in-place, greatly increasing the processing speed of large volumes of images.</p>
<p>All operations that support in-place operations will have an argument named “target” that can be set to the value “self”. For instance:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Find the path to the bunny.png image provided with Rvision</span>
<span class="va">path_to_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"sample_img"</span>, <span class="st">"bunny.png"</span>, package <span class="op">=</span> <span class="st">"Rvision"</span><span class="op">)</span>

<span class="co"># Load the image in memory</span>
<span class="va">my_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image.html">image</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="va">path_to_image</span><span class="op">)</span>

<span class="co"># Plot the original image</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span>

<span class="co"># Apply a Gaussian blur in place. Note that the operation will not return </span>
<span class="co"># anything and the result will replace the content of my_image.</span>
<span class="fu"><a href="../reference/gaussianBlur.html">gaussianBlur</a></span><span class="op">(</span><span class="va">my_image</span>, <span class="fl">11</span>, <span class="fl">11</span>, <span class="fl">3</span>, <span class="fl">3</span>, target <span class="op">=</span> <span class="st">"self"</span><span class="op">)</span>

<span class="co"># Plot original image after modification</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span></code></pre></div>
<hr>
</div>
<div id="preserving-originals-with-copy-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#preserving-originals-with-copy-operations" class="anchor"></a>4.2 - Preserving originals with copy operations</h2>
<p>The downside of in-place operations is that the modification is destructive: the original object in memory is replaced bit for bit by its modified version (we are just talking about the RAM representation of the object here; the original file on your drive is never modified directly).</p>
<p>However, it may be desirable in some cases to keep the original object in memory untouched. For this purpose, all the functions in <code>Rvision</code> that can modify images also give users the option to perform their operations on a copy of the original image. This will be slower but resemble the usual behavior of <code>R</code> functions.</p>
<p>By default, all operations are copy operations but this can be explicitely specified by setting the “target” argument to “new”. For instance:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Find the path to the bunny.png image provided with Rvision</span>
<span class="va">path_to_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"sample_img"</span>, <span class="st">"bunny.png"</span>, package <span class="op">=</span> <span class="st">"Rvision"</span><span class="op">)</span>

<span class="co"># Load the image in memory</span>
<span class="va">my_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image.html">image</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="va">path_to_image</span><span class="op">)</span>

<span class="co"># Apply a Gaussian blur to a copy of the image. </span>
<span class="va">my_blurred_copy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gaussianBlur.html">gaussianBlur</a></span><span class="op">(</span><span class="va">my_image</span>, <span class="fl">11</span>, <span class="fl">11</span>, <span class="fl">3</span>, <span class="fl">3</span>, target <span class="op">=</span> <span class="st">"new"</span><span class="op">)</span>

<span class="co"># Plot original image</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span>

<span class="co"># Plot blurred copy </span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">my_blurred_copy</span><span class="op">)</span></code></pre></div>
<hr>
</div>
<div id="the-best-of-both-worlds-target-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#the-best-of-both-worlds-target-operations" class="anchor"></a>4.3 - The best of both worlds: target operations</h2>
<p>But what if I want to preserve the original object AND be fast at the same time?</p>
<p>Then you are in luck. <code>Rvision</code> - still thanks to <code>OpenCV</code> - also offers “target” operations, that is operations which results can be stored in another image in memory (the target) as long as that image was pre-allocated before the operation takes place and that it has the same memory footprint as the original image. This is as fast as in-place operations and it does not modify the original image; instead, it modifies a separate image that serves as a placeholder for the results.</p>
<p>All operations that support target operations will have an argument named “target” that can be set to the name of the target image. For instance:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Find the path to the bunny.png image provided with Rvision</span>
<span class="va">path_to_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"sample_img"</span>, <span class="st">"bunny.png"</span>, package <span class="op">=</span> <span class="st">"Rvision"</span><span class="op">)</span>

<span class="co"># Load the image in memory</span>
<span class="va">my_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image.html">image</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="va">path_to_image</span><span class="op">)</span>

<span class="co"># Create a zero-filled target image with the memory footprint of the original</span>
<span class="va">my_target</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zeros.html">zeros</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span>, <span class="fu"><a href="../reference/nrow.Rcpp_Image.html">nchan</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span>, <span class="fu"><a href="../reference/bitdepth.html">bitdepth</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Apply a Gaussian blur to the original image but store the results in the </span>
<span class="co"># target. Note that the operation will not return anything and the result will </span>
<span class="co"># replace the content of my_target.</span>
<span class="fu"><a href="../reference/gaussianBlur.html">gaussianBlur</a></span><span class="op">(</span><span class="va">my_image</span>, <span class="fl">11</span>, <span class="fl">11</span>, <span class="fl">3</span>, <span class="fl">3</span>, target <span class="op">=</span> <span class="va">my_target</span><span class="op">)</span>

<span class="co"># Plot original image</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span>

<span class="co"># Plot target</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">my_target</span><span class="op">)</span></code></pre></div>
<hr>
</div>
<div id="when-to-use-in-place-copy-and-target-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#when-to-use-in-place-copy-and-target-operations" class="anchor"></a>4.4 - When to use in-place, copy, and target operations?</h2>
<p>If you are going to process a single image (or a small batch of images) with only one or a few simple operations, then copy operations are probably the best choice. They will be fast enough (a fraction of a second at most) and more familiar to <code>R</code> users since they essentially mimic the behavior of traditional <code>R</code> functions by always returning a new object. They are also very useful when troubleshooting your pipeline since every step will be saved in a separate object and can therefore be inspected individually for problems.</p>
<p>If you are going to process a large number of images (typically, when processing a video or camera stream) and you only care about preserving the final result of the pipeline, then in-place operations will be the best choice. They will provide the best performance both in terms of speed and overall memory footprint.</p>
<p>Finally, if you are going to process a large number of images but need to preserve the original image or the result of an intermediary step in your pipeline (e.g. in order to reuse it later in your pipeline), then target operations should be preferred.</p>
<p>Note that the different operation types are not mutually exclusive and can be used together in the same processing pipeline for increased flexibility.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://www.theswarmlab.com">Simon Garnier</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '3a2946bbe34c635ad2e2aae74a83374b',
    indexName: 'swarm-lab-rvision',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
