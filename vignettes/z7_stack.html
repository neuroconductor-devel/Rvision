<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>7 - Video stacks</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">7 - Video stacks</h1>


<div id="TOC">
<ul>
<li><a href="#introducting-video-stacks" id="toc-introducting-video-stacks">7.1 - Introducting video
stacks</a></li>
<li><a href="#creating-video-stacks" id="toc-creating-video-stacks">7.2
- Creating video stacks</a></li>
<li><a href="#using-video-stacks" id="toc-using-video-stacks">7.3 -
Using video stacks</a></li>
</ul>
</div>

<div id="introducting-video-stacks" class="section level2">
<h2>7.1 - Introducting video stacks</h2>
<p>Starting with <code>Rvision</code> version 0.7.0, users can create
video stacks. A video stack (<code>VideoStack</code>) is essentially a
list of videos with similar properties (in particular, the same
dimensions) that behaves almost entirely like a single continuous
<code>Video</code> object. For that reason, <code>VideoStack</code>
objects are particularly useful for applications requiring the
combination of multiple video files and/or <code>Video</code> objects.
For instance, video stacks can greatly simplify the merging of two
separate video files into a single one, or the processing of a
continuous sequence that was split into multiple files during
recording.</p>
<p>In this vignette, we will briefly describe how to create and
manipulate <code>VideoStack</code> objects. Since their operation is
very similar to that of <code>Video</code> objects, using
<code>VideoStack</code> objects should not require much additional
learning for a regular user of <code>Rvision</code>.</p>
<hr />
</div>
<div id="creating-video-stacks" class="section level2">
<h2>7.2 - Creating video stacks</h2>
<p>You can create a video stack by passing to the
<code>videoStack</code> function a combination of existing
<code>Video</code> objects and/or character strings pointing toward the
location of video files on your computer. For instance:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Find the path to the Balloon.mp4 video provided with Rvision</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>path_to_video <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;sample_vid/Balloon.mp4&quot;</span>, <span class="at">package =</span> <span class="st">&quot;Rvision&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Open the video file stream</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>my_video <span class="ot">&lt;-</span> <span class="fu">video</span>(<span class="at">filename =</span> path_to_video)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># Create a video stack from a character string and a Video object</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>my_video_stack <span class="ot">&lt;-</span> <span class="fu">videoStack</span>(path_to_video, my_video)</span></code></pre></div>
<p>The paths to video files and the existing <code>Video</code> objects
can be passed as separate arguments, or as a list or a vector. If a path
is provided, the corresponding video will be opened before being added
to the stack. If a <code>Video</code> object is provided, a pointer to
the original <code>Video</code> object will be added to the stack (i.e.,
they will share the same reader head and any modification to the
position of the reader head in the stack will be applied to the original
object, and vice versa).</p>
<p>A video stack can contain as many videos as desired, with the only
restriction that they should all have the same dimensions.</p>
<p>Once a <code>VideoStack</code> object is not required anymore, it can
be released from memory as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">release</span>(my_video_stack)</span></code></pre></div>
<hr />
</div>
<div id="using-video-stacks" class="section level2">
<h2>7.3 - Using video stacks</h2>
<p>Once a <code>VideoStack</code> object is created, it can be used as a
<code>Video</code> object with the same number of frames as the sum of
the frames in the <code>Video</code> objects that it contains. For
instance, to read a specific frame of the stack, you can use the
<code>readNext()</code> and <code>readFrame()</code> functions, as you
would normally do with <code>Video</code> objects:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Capture the next available frame from the my_video_stack object created earlier</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>my_image <span class="ot">&lt;-</span> <span class="fu">readNext</span>(my_video_stack)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Capture frame 100 from the my_video_stack object created earlier</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>my_image <span class="ot">&lt;-</span> <span class="fu">readFrame</span>(my_video_stack, <span class="dv">100</span>)</span></code></pre></div>
<p>At any time, you can check the state of the video stack as
follows:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># What is the current number of videos in the stack? </span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">length</span>(my_video_stack)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># What is the number of frames in the stack? </span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="fu">nframes</span>(my_video_stack)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co"># What is the index of the next frame available? </span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="fu">frame</span>(my_video_stack)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co"># What are the dimensions of the queue? </span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="fu">dim</span>(my_video_stack)</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="fu">nrow</span>(my_video_stack)</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="fu">ncol</span>(my_video_stack)</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co"># What are the frame rates of the videos in the stack?</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="fu">fps</span>(my_video_stack)</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co"># What are the codecs of the videos in the stack?</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="fu">codec</span>(my_video_stack)</span></code></pre></div>
<p>Finally, you can access individually, add, or replace videos in the
stack as follows:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Access the first video in the stack individually</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>my_video_stack[[<span class="dv">1</span>]]</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># Replace the first video in the stack </span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>my_video_stack[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> my_video</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co"># Add a video at the end of the stack </span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>my_video_stack[[<span class="fu">length</span>(my_video_stack) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> my_video</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co"># Remove a video from the stack</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>my_video_stack[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
